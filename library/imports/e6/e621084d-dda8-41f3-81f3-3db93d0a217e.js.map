{"version":3,"sources":["assets\\script\\white_ball.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewClass extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    cue:cc.Node = null;\r\n    // 白球最小拖动距离\r\n    mix_dst : number = 20;\r\n\r\n    start_pos:cc.Vec2 = cc.v2(0,0);\r\n\r\n    body:cc.RigidBody = null;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n        // 白球起始位置\r\n        this.start_pos.x = this.node.x;\r\n        this.start_pos.y = this.node.y;\r\n\r\n        // 获得刚体\r\n        this.body = this.getComponent(cc.RigidBody);\r\n\r\n        // 获取 cue 实体\r\n        let cue_inst = this.cue.getComponent('cue');\r\n        \r\n        // START(点击下去),MOVE(phyManager.debugDrawFlags触摸移动),ENDED(触摸在节点范围内弹起),CANCEL(节点范围外弹起)\r\n        this.node.on(cc.Node.EventType.TOUCH_START,function(e){\r\n\r\n        }.bind(this),this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){\r\n            var w_pos = e.getLocation();\r\n            var dst = this.node.parent.convertToNodeSpaceAR(w_pos);\r\n            var src = this.node.getPosition();\r\n            // 计算两个点之间的向量\r\n            var dir = dst.sub(src);\r\n            // 向量的模\r\n            let len = dir.mag();\r\n            \r\n            // 球杆拖动距离太短\r\n            if(len < this.mix_dst){\r\n                this.cue.active = false;//设置球杆为隐藏\r\n                return;\r\n            }else{\r\n                this.cue.active = true;\r\n            }\r\n\r\n            var r = Math.atan2(dir.y,dir.x);\r\n            var degree = r * (180 / Math.PI);\r\n            // degree = 360 - degree;\r\n\r\n            // 球杆旋转角度\r\n            this.cue.angle = degree + 180;\r\n            // 球杆的位置\r\n            var cue_pos = dst;\r\n            var cue_len_half = this.cue.width * 0.5;\r\n            cue_pos.x += (cue_len_half * dir.x / len);\r\n            cue_pos.y += (cue_len_half * dir.y / len);\r\n\r\n            // 设置球杆位置\r\n            this.cue.setPosition(cue_pos);\r\n        }.bind(this),this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_END,function(e){\r\n            if(this.cue.active === false){\r\n                return;\r\n            }\r\n            cue_inst.shoot_at(this.node.getPosition());\r\n        }.bind(this),this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){\r\n            if(this.cue.active === false){\r\n                return;\r\n            }\r\n            cue_inst.shoot_at(this.node.getPosition());\r\n            // this.cue.shoot_at(this.node.getPosition());\r\n        }.bind(this),this);\r\n    }\r\n\r\n    reset(){\r\n        this.node.scale = 1;\r\n        this.node.x = this.start_pos.x;\r\n        this.node.y = this.start_pos.y; \r\n\r\n        // 速度设置为0\r\n        this.body.linearVelocity = cc.v2(0,0);\r\n        this.body.angularVelocity = 0;\r\n    }\r\n\r\n    onBeginContact(contact,selfCollider,otherCollider){\r\n        // 白球有可能碰到  球杆，球，台球边，球袋\r\n        // 第2组是球袋\r\n        if(otherCollider.node.groupIndex == 2){\r\n            // 隔1秒，要把球放回去\r\n            this.node.scale = 0;\r\n            this.scheduleOnce(this.reset.bind(this),1);\r\n            \r\n            return;\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}